(function(g,h,c,f){var a,q,k,p;a={version:"0.1.0",is_mobile:navigator.userAgent.match(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i),fullscreen:{vendor:f,supported:!1,enabled:f,element:f,request:f,exit:f},animation:{vendor:f,request:f,cancel:f,start_time:(g.Date.now||(new g.Date).getTime)(),now:function(){return(g.Date.now||(new g.Date).getTime)()-a.animation.start_time}},util:{polyfill:f,fragmentStringToHTMLDocument:f,startsWith:f,endsWith:f,indexOfMatch:f,getAbsolutePath:f,epochToClock:f},
$$:{body:c("body"),document:c(h)},tick:f,tick_id:f,zoetropes:[]};q={volume_steps:4,timeline_start:"left",timeline_dimension:"width",volume_start:"bottom",volume_dimension:"height",window_flag_cursor:1E3,fullscreen_flag_cursor:2500,zoetrope_template:'<div class="zoetrope"><div class="container"><div class="poster"><div class="play-button"></div><div class="throbber"></div></div><media></media><div class="controls"><div class="playback-toggle"></div><div class="time"></div><div class="timeline"><div class="played"></div><div class="buffered"></div></div><div class="quality-toggle"></div><div class="mute-toggle"></div<<div class="volume"><div class="level"></div></div><div class="fullscreen-toggle"></div></div></div></div>'};
a.util.polyfill=function(){var b,d,e;b={w3c:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",change:"fullscreenchange",error:"fullscreenerror"},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitCancelFullScreen",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",
change:"mozfullscreenchange",error:"mozfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",change:"MSFullscreenChange",error:"MSFullscreenError"}};for(d in b)if(b[d].enabled in h){a.fullscreen.vendor=d;a.fullscreen.supported=!0;break}a.fullscreen.supported&&(a.fullscreen.request=function(d){return d[b[a.fullscreen.vendor].request].apply(d)},a.fullscreen.exit=h[b[a.fullscreen.vendor].exit].bind(h),a.$$.document.on(b[a.fullscreen.vendor].change,
function(d){a.fullscreen.enabled=h[b[a.fullscreen.vendor].enabled];a.fullscreen.element=h[b[a.fullscreen.vendor].element];d.type="zoetropefullscreenchange";c(d.target).trigger(c.Event("zoetropefullscreenchange",d))}),a.$$.document.on(b[a.fullscreen.vendor].error,function(b){b.type="zoetropefullscreenerror";c(b.target).trigger(c.Event("zoetropefullscreenerror",b))}),a.fullscreen.enabled=h[b[a.fullscreen.vendor].enabled],a.fullscreen.element=h[b[a.fullscreen.vendor].element]);e={w3c:{request:"requestAnimationFrame",
cancel:"cancelAnimationFrame"},webkit:{request:"webkitRequestAnimationFrame",cancel:"webkitCancelAnimationFrame"},moz:{request:"mozRequestAnimationFrame",cancel:"mozCancelRequestAnimationFrame"}};for(d in e)if(e[d].request in g){a.animation.vendor=d;break}a.animation.vendor?g.performance&&g.performance.now?(a.animation.request=g[e[a.animation.vendor].request].bind(g),a.animation.cancel=g[e[a.animation.vendor].cancel].bind(g),a.animation.start_time=g.performance.timing.navigationStart,a.animation.now=
g.performance.now.bind(g.performance)):a.animation.request=function(b,d){return g[e[a.animation.vendor].request].apply(g,[function(d){b(d-a.animation.start_time)},d])}:(p=a.animation.start_time,k=f,a.animation.request=function(b){var d;k=a.animation.now();d=Math.max(0,1E3/60-(k-p));return g.setTimeout(function(){b(p=k+d)},d)},a.animation.cancel=function(b){clearTimeout(b)});try{(new DOMParser).parseFromString("","text/html")?a.util.fragmentStringToHTMLDocument=function(b){return(new DOMParser).parseFromString(b,
"text/html")}:a.util.fragmentStringToHTMLDocument=function(b){var a;a=h.implementation.createHTMLDocument("");a.body.innerHTML=b;return a}}catch(r){a.util.fragmentStringToHTMLDocument=function(b){var a;a=h.createElement("div");a.innerHTML=b;return a}}};a.util.startsWith=function(b,a){return 0===b.indexOf(a,0,a.length)};a.util.endsWith=function(b,a){return-1!==b.indexOf(a,b.length-a.length)};a.util.indexOfMatch=function(b,a,e){var c;e=e||this;c=-1;b.some(function(b,f,g){return a.call(e,b,f,g)?(c=f,
!0):!1},e);return c};a.util.getAbsolutePath=function(b,d){var e,c,f,g;if(b){if(a.util.startsWith(b,"data:")||-1!==b.indexOf("://"))return b;if(a.util.startsWith(b,"//"))return d.split("//")[0]+b}b=b||"";e=(d=d?d.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"")?d.split("/"):[];c=b.split("/");for(f=0;f<c.length;f++)switch(g=c[f],g){case ".":break;case "..":e.length&&e.pop();break;default:e.push(g)}return e.join("/")};a.util.epochToClock=function(b){var a,e;a=parseInt(b/3600)%24;e=parseInt(b/60)%60;b=parseInt(b%
60);return(a?(10>a?"0":"")+a+":":"")+((10>e?"0":"")+e)+":"+((10>b?"0":"")+b)};a.tick=function(b){var d;a.tick_id=a.animation.request(a.tick);for(d in a.zoetropes)a.zoetropes[d].state.dom_needs_update&&(a.zoetropes[d].state.dom_needs_update=!1,a.zoetropes[d].updateDOM(b))};a.Zoetrope=function(b){this.init(b)};a.Zoetrope.prototype={constructor:a.Zoetrope,init:function(b,d){var e;this.$$={};this.is_native=d||a.is_mobile;if(b&&!b.getAttribute("data-zoetrope-id")){if(this.is_native){if(this.current=b,
this.$$.current=this.$$.media_1=c(b),this.sources=this.getSources(),this.state={dom_needs_update:!1},this.current.src=this.sources.mobile||this.current.src,this.id=a.zoetropes.length,this.$$.media_1.addClass("mobile").attr("data-zoetrope-id",a.zoetropes.length),this.$$.current.attr("infer"))this.$$.current.on("hover"===this.$$.current.attr("infer")?"mouseover touchstart":"mousedown touchstart",c.proxy(this.load,this))}else e=g.getComputedStyle(h.querySelector(".zoetrope")).content,e=e.slice(1,-1).replace(/(?:\\a)|(?:\\9)/g,
"").replace(/\\\\/g,"\\"),this.theme_settings=c.extend(!0,q,JSON.parse(e)),this.$$.wrapper=c(a.util.fragmentStringToHTMLDocument(this.theme_settings.zoetrope_template,"text/html").querySelector("div.zoetrope")),this.$$.wrapper.addClass("using-1"),this.$$.container=this.$$.wrapper.children(".container"),this.$$.media_1=c(b.cloneNode(!0)),this.$$.poster=this.$$.container.find(".poster"),this.$$.poster.length&&this.$$.media_1.attr("poster")&&(this.$$.poster.css("background-image",'url("'+this.$$.media_1.attr("poster")+
'")'),this.$$.media_1.removeAttr("poster")),this.$$.media_1.prop("controls")?this.$$.media_1.prop("controls",!1):this.$$.container.find(".controls").remove(),this.base_class=this.$$.media_1.attr("class"),this.$$.wrapper.attr("id",this.$$.media_1.attr("id")),this.$$.media_1.removeAttr("id").removeAttr("class"),b.readyState&&(this.$$.media_1.css({height:c(b).height(),width:c(b).width()}),this.$$.media_1.one("loadedmetadata",c.proxy(function(){this.$$.media_1.removeAttr("style");this.$$.media_2.removeAttr("style")},
this))),this.$$.media_2=c(this.$$.media_1[0].cloneNode(!0)),this.$$.media_2.prop("autoplay",!1),this.$$.media_2[0].src="",this.$$.media_2[0].load(),this.$$.media_2.attr("preload","auto"),this.$$.container.find("media").replaceWith(this.$$.media_1),this.$$.media_2.insertAfter(this.$$.media_1),this.$$.current=this.$$.media_1,this.$$.standby=this.$$.media_2,this.$$.play_button=this.$$.container.find(".play-button"),this.$$.controls=this.$$.container.find(".controls"),this.$$.playback_toggle=this.$$.container.find(".playback-toggle"),
this.$$.time=this.$$.container.find(".time"),this.$$.timeline=this.$$.container.find(".timeline"),this.$$.played=this.$$.container.find(".played"),this.$$.buffered=this.$$.container.find(".buffered"),this.$$.quality_toggle=this.$$.container.find(".quality-toggle"),this.$$.mute_toggle=this.$$.container.find(".mute-toggle"),this.$$.volume=this.$$.container.find(".volume"),this.$$.level=this.$$.container.find(".level"),this.$$.fullscreen_toggle=this.$$.container.find(".fullscreen-toggle"),this.id=a.zoetropes.length,
this.$$.media_1.removeClass("zoetrope").attr("data-zoetrope-id",a.zoetropes.length),this.$$.media_2.removeClass("zoetrope").attr("data-zoetrope-id",a.zoetropes.length),this.$$.wrapper.attr("data-zoetrope-id",a.zoetropes.length),this.current=this.$$.current[0],this.standby=this.$$.standby[0],this.sources=this.getSources(),this.state={general:"stopped",mousemove:f,scrubbed_while_playing:!1,switching:!1,switching_from:f,switching_to:f,dom_needs_update:!0,last_data:""},this.current.current_buffer=[0,
0],this.standby.current_buffer=[0,0],this.$$.wrapper.on("selectstart",function(b){b.preventDefault();return!1}),this.$$.container.on("mousemove",c.proxy(function(){this.state.last_mousemove=a.animation.now();this.state.dom_needs_update=!0},this)),this.$$.current.on("progress",c.proxy(this.getBuffer,this)),this.$$.standby.on("progress",c.proxy(this.getBuffer,this)),this.updateMediaHandlers(),this.$$.current.attr("infer")&&(this.$$.play_button.on("hover"===this.$$.current.attr("infer")?"mouseover touchstart":
"mousedown touchstart",c.proxy(this.load,this)),this.$$.playback_toggle.on("hover"===this.$$.current.attr("infer")?"mouseover touchstart":"mousedown touchstart",c.proxy(this.load,this))),this.$$.play_button.on("click",c.proxy(this.play,this)),this.$$.playback_toggle.on("click",c.proxy(this.togglePlayback,this)),this.$$.timeline.on("click mousedown",c.proxy(this.scrubTimeline,this)),this.$$.quality_toggle.on("click",c.proxy(this.toggleQuality,this)),this.$$.mute_toggle.on("click",c.proxy(this.toggleMute,
this)),this.$$.volume.on("click mousedown",c.proxy(this.scrubVolume,this)),this.$$.fullscreen_toggle.on("click",c.proxy(this.toggleFullscreen,this)),a.$$.document.on("zoetropefullscreenchange",c.proxy(this._DOMNeedsUpdate,this)),c(b).replaceWith(this.$$.wrapper);a.zoetropes.push(this)}},getSources:function(){var b,d;b="."+this.current.currentSrc.split(".").pop();d={qualities_and_paths:[],qualities:[],paths:[],paths_to_qualities:{},qualities_to_paths:{},mobile:f};this.$$.current.children("source").each(function(){var e,
c;e=this.getAttribute("src");if(""!==this.current.canPlayType(this.type)||a.util.endsWith(e,b))c=this.getAttribute("data-quality")||"sd",e=a.util.getAbsolutePath(e,h.location.href),d.qualities_and_paths.push({quality:c,path:e}),d.qualities.push(c),d.paths.push(e),d.paths_to_qualities[e]=c,d.qualities_to_paths[c]=e,d.mobile||""!==this.getAttribute("mobile")||(d.mobile=e)});return d},updateDOM:function(b){var d,e,c,f,g,h,k,m,l,n;d=this.$$.current===this.$$.media_1?"1":"2";e=this.current.duration||0;
c="playing"===this.state.general?Math.min((this.current.currentTime||0)+(b-a.animation.now())/1E3,e):this.current.currentTime;this.state.switching?(f=this.standby.current_buffer[0]/e*100,g=(this.standby.current_buffer[1]-this.standby.current_buffer[0])/e*100):(f=this.current.current_buffer[0]/e*100,g=(this.current.current_buffer[1]-this.current.current_buffer[0])/e*100);h=this.current.currentSrc?this.sources.paths_to_qualities[this.current.currentSrc]:this.sources.qualities[0];k=this.current.muted?
0:100*this.current.volume;m=a.fullscreen.supported?this.$$.container.is(a.fullscreen.element):"unsupported";b=this.state.last_mousemove+(!0===m?this.theme_settings.fullscreen_flag_cursor:this.theme_settings.window_flag_cursor)>=b;l=[this.state.general,b,this.state.switching,d,e,c,f,g,h,k,this.current.muted,m].join();l!==this.state.last_data&&(this.state.last_data=l,l=a.util.epochToClock(c),n=e?a.util.epochToClock(e-c):"00:00",e=c/e*100,c=this.current.muted?0:Math.ceil(this.current.volume*(this.theme_settings.volume_steps-
1)),this.$$.wrapper.attr({"data-using":d,"data-state":this.state.general,"data-cursor":b,"data-quality":h,"data-switching":this.state.switching,"data-intended":this.state.switching||h,"data-volume":c,"data-fullscreen":m,"data-time":l,"data-remaining":n,"class":[this.base_class,"using-"+d,"state-"+this.state.general,"cursor-"+b,"quality-"+h,"switching-"+this.state.switching,"intended-"+this.state.switching||h,"volume-"+c,"fullscreen-"+m,"time-"+l,"remaining-"+n].join(" ")}),this.$$.played.css(this.theme_settings.timeline_dimension,
e+"%"),this.$$.buffered.css(this.theme_settings.timeline_start,f+"%").css(this.theme_settings.timeline_dimension,g+"%"),this.$$.quality_toggle.attr({"data-quality":h,"data-switching":this.state.switching,"data-intended":this.state.switching||h}),this.$$.current.prop("muted",this.current.muted),this.$$.mute_toggle.attr("data-volume",c),this.$$.level.css(this.theme_settings.volume_dimension,k+"%"),this.$$.fullscreen_toggle.attr("data-fullscreen",m),this.$$.time.attr({"data-time":l,"data-remaining":n}));
this.state.dom_needs_update=b},_DOMNeedsUpdate:function(){this.state.dom_needs_update=!0},updateMediaHandlers:function(){this.$$.current.one("loadstart",c.proxy(function(){this.sources=this.getSources();this.state.dom_needs_update=!0},this));this.$$.current.on("play",c.proxy(this.play,this));this.$$.current.on("pause",c.proxy(this.pause,this));this.$$.current.on("volumechange",c.proxy(this._DOMNeedsUpdate,this));this.$$.current.on("ended",c.proxy(this.ended,this));this.$$.current.on("timeupdate",
c.proxy(this._DOMNeedsUpdate,this));this.$$.standby.off("play",c.proxy(this.play,this));this.$$.standby.off("pause",c.proxy(this.pause,this));this.$$.standby.off("volumechange",c.proxy(this._DOMNeedsUpdate,this));this.$$.standby.off("ended",c.proxy(this.ended,this));this.$$.standby.off("timeupdate",c.proxy(this._DOMNeedsUpdate,this))},togglePlayback:function(b){if(!b||this.$$.playback_toggle.is(b.target))"playing"===this.state.general?this.current.pause():this.current.play()},scrubTimeline:function(b){var d,
e,f;b&&(this.$$.timeline.is(b.target)||"mousedown"!==b.type)&&("mousedown"===b.type&&(this.state.scrubbed_while_playing="playing"===this.state.general,this.current.pause(),a.$$.body.on("mousemove mouseup mouseleave",c.proxy(this.scrubTimeline,this))),d=this.$$.timeline.offset(),e=this.$$.timeline.height(),f=this.$$.timeline.width(),"width"===this.theme_settings.timeline_dimension?(d=Math.min(Math.max(0,b.pageX-d.left),f),d="left"===this.theme_settings.timeline_start?d:f-d,e=d/f):(d=Math.min(Math.max(0,
b.pageY-d.top),e),d="top"===this.theme_settings.timeline_start?d:e-d,e=d/e),this.current.currentTime=e*this.current.duration,this.state.dom_needs_update=!0,"mouseup"===b.type||"mouseleave"===b.type)&&(this.scrubbed_while_playing&&this.current.play(),a.$$.body.off("mousemove mouseup mouseleave",c.proxy(this.scrubTimeline,this)))},toggleQuality:function(){var b;b=(this.state.switching?this.sources.qualities.indexOf(this.state.switching):this.sources.paths.indexOf(this.current.currentSrc))+1;this.changeQuality(this.sources.qualities[b%
this.sources.qualities.length])},changeQuality:function(b){this.state.switching&&b===this.sources.paths_to_qualities[this.current.currentSrc]&&(this.state.switching=!1,this.state.switching_from=f,this.state.switching_to=f,this.standby.src="",this.standby.load(),this.state.dom_needs_update=!0);b!==this.sources.paths_to_qualities[this.current.currentSrc]&&(this.state.switching=b,this.state.switching_from=this.current,this.state.switching_to=this.standby,this.standby.current_buffer=[0,0],this.standby.src=
this.sources.qualities_to_paths[b],this.standby.load(),this.state.dom_needs_update=!0,a.animation.request(this._syncMedia.bind(this)),this.$$.standby.trigger("progress"))},_syncMedia:function(b){this.state.switching&&(3>this.state.switching_to.readyState?(a.animation.request(this._syncMedia.bind(this)),0<this.state.switching_to.readyState&&(this.state.switching_to.currentTime=this.state.switching_from.currentTime+("playing"===this.state.general?Math.max(0,b-a.animation.now())/1E3:0))):this._finishChangingQuality())},
_finishChangingQuality:function(){this.state.switching=!1;this.state.switching_from=f;this.state.switching_to=f;this.$$.wrapper.css({height:this.$$.wrapper.height(),width:this.$$.wrapper.width()});this.standby.muted=!0;"playing"===this.state.general&&this.standby.play();this.$$.standby.one("timeupdate",c.proxy(function(){var b;b=this.$$.current;this.$$.current=this.$$.standby;this.$$.standby=b;b=this.current;this.current=this.standby;this.standby=b;this.updateMediaHandlers();this.current.volume=this.standby.volume;
this.current.muted=this.standby.muted?!0:!(this.standby.muted=!this.standby.muted);this.$$.current.prop("muted",this.current.muted);this.state.dom_needs_update=!0;this.$$.current.one("timeupdate",c.proxy(function(){setTimeout(c.proxy(function(){this.standby.src="";this.standby.load()},this),1E3);this.$$.wrapper.css({height:"auto",width:"auto"})},this))},this));"playing"!==this.state.general&&(this.$$.standby.one("timeupdate",c.proxy(function(){this.$$.current.trigger("timeupdate")},this)),this.$$.standby.trigger("timeupdate"))},
toggleMute:function(b){if(!b||this.$$.mute_toggle.is(b.target))this.current.muted&&!this.current.volume&&(this.current.volume=1),this.current.muted=!this.current.muted,this.state.dom_needs_update=!0},scrubVolume:function(b){var d,e,f;if(b&&(this.$$.volume.is(b.target)||"mousedown"!==b.type)){if("mousedown"===b.type)a.$$.body.on("mousemove mouseup mouseleave",c.proxy(this.scrubVolume,this));d=this.$$.volume.offset();e=this.$$.volume.height();f=this.$$.volume.width();"width"===this.theme_settings.volume_dimension?
(d=Math.min(Math.max(0,b.pageX-d.left),f),d="left"===this.theme_settings.volume_start?d:f-d,e=d/f):(d=Math.min(Math.max(0,b.pageY-d.top),e),d="top"===this.theme_settings.volume_start?d:e-d,e=d/e);this.current.volume=e;this.current.muted=!this.current.volume;this.state.dom_needs_update=!0;"mouseup"!==b.type&&"mouseleave"!==b.type||a.$$.body.off("mousemove mouseup mouseleave",c.proxy(this.scrubVolume,this))}},toggleFullscreen:function(){a.fullscreen.enabled&&(a.fullscreen.element?this.$$.container.is(a.fullscreen.element)&&
a.fullscreen.exit():a.fullscreen.request(h.querySelector('.zoetrope[data-zoetrope-id="'+this.id+'"] .container')),this.state.dom_needs_update=!0)},load:function(){"auto"!==this.$$.current.attr("preload")&&this.$$.current.attr("preload","auto")},play:function(b,a){a||b&&"play"===b.type?(4===this.current.readyState?this.state.general="playing":"stopped"===this.state.general&&(this.state.general="loading",this.$$.current.attr("preload","auto"),this.current.currentTime===this.current.duration&&(this.current.currentTime=
0)),this.$$.current.trigger("progress"),this.state.dom_needs_update=!0):this.current.play()},pause:function(b,a){a||b&&"pause"===b.type?"playing"===this.state.general&&(this.state.general="paused",this.state.dom_needs_update=!0):this.current.pause()},ended:function(){this.state.general="stopped";this.state.dom_needs_update=!0},getBuffer:function(b){var a,c,f;b=this.current===b.target?this.current:this.standby;b.current_buffer=[0,0];for(a=0;a<b.buffered.length;a++)if(c=b.buffered.start(a),f=b.buffered.end(a),
this.current.currentTime>=c&&this.current.currentTime<=f){b.current_buffer=[c,f];break}"loading"===this.state.general&&4===this.current.readyState&&(this.state.general="playing");this.state.dom_needs_update=!0}};a.getZoetrope=function(b){return a.videos[c(b).attr("data-zoetrope-id")||c(b).parents(".zoetrope").attr("data-zoetrope-id")]};a.setupZoetrope=function(b,c){return new a.Zoetrope(c||b)};a.init=function(){a.is_mobile||(a.util.polyfill(),a.tick_id||(a.tick_id=a.animation.request(a.tick)));c("video.zoetrope, audio.zoetrope").each(a.setupZoetrope)};
"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports.zoetrope=a):"function"===typeof define&&define.amd?define([],function(){return a}):(a._original_zoetrope=g.zoetrope,a.noConflict=function(){g.zoetrope=a._original_zoetrope;a._original_zoetrope=f;a.noConflict=f;return a},g.zoetrope=a)})(this,document,jQuery);
